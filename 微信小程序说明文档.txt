核心结论

- 你的项目当前是“网页应用”（React + Vite + index.html 挂载 DOM）的典型结构，运行在浏览器环境。
- 微信小程序不是浏览器，它有独立的渲染引擎、页面路由与系统 API，要求完全不同的工程结构与打包运行方式。
- 要在小程序端形成页面，需要按小程序规范组织工程（ app.json 、 pages/* 、WXML/WXSS/JS），或使用跨端框架将 React 代码编译成小程序产物。
环境差异

- 运行时
  - 网页：浏览器（有 window/document 、DOM、标准 CSS/HTML）
  - 小程序：封装的 JS 运行环境 + WXML 渲染层，无 DOM，也无法直接访问 window/document
- 渲染模型
  - 网页：直接操作 DOM（React 将 JSX 转为 react/jsx-runtime 函数，最终插入 DOM）
  - 小程序：逻辑层与渲染层分离，页面由 WXML 模板渲染；组件与数据绑定通过框架协议，不存在浏览器 DOM API
- 系统 API
  - 网页： fetch 、 localStorage 、 navigator 、 tel: 链接等
  - 小程序： wx.request 、 wx.setStorage / wx.getStorage 、 wx.getPhoneNumber 、 wx.makePhoneCall 等
- 网络规则
  - 网页：CORS 由服务端响应头控制（ Access-Control-Allow-Origin 等）
  - 小程序：必须在“小程序后台”配置“request 合法域名”，否则请求被拦截；不走浏览器 CORS
- 权限与能力
  - 网页：浏览器权限模型，受 CSP/CORS 限制
  - 小程序：通过微信授权弹窗获取手机号、位置、摄像头等；登录态与用户数据通过微信生态授权与接口获取
- 打包与运行
  - 网页：本地 npm run dev/build ，浏览器打开或部署到 Web 服务器
  - 小程序：微信开发者工具打开小程序工程，构建为小程序产物并上传审核发布
工程结构对比

- 网页应用（你当前的）
  - 入口与挂载： d:\develop\ISO\Campus-Repair-Mini-Program\html-code\index.html:39 创建 div#root
  - React 渲染： d:\develop\ISO\Campus-Repair-Mini-Program\html-code\index.tsx:5-15 使用 ReactDOM.createRoot(root) 挂载
  - 路由与视图： App.tsx 内部用状态 View 切换不同视图（登录、首页、详情、个人中心等），例如 d:\develop\ISO\Campus-Repair-Mini-Program\html-code\App.tsx:27-34, 152-183, 185-203, 216-547
  - 构建工具： vite.config.ts:1-22 配置插件与别名
- 微信小程序（规范要求）
  - 工程根： app.json （全局配置与路由）+ app.js （应用入口）+ app.wxss （全局样式）
  - 页面： pages/<name>/index.wxml （模板）+ index.wxss （样式）+ index.js （逻辑）+ index.json （页面配置）
  - 组件： components/<name>/*.wxml|wxss|js|json
  - 系统 API： wx.request 、 wx.getPhoneNumber 、 wx.makePhoneCall 、 wx.setStorage 等
  - 打开方式：微信开发者工具导入项目并运行；发布时上传到微信平台审核
功能差异示例

- 拨号逻辑
  - 网页： <a href="tel:..."> ，你的详情页拨号位置在 d:\develop\ISO\Campus-Repair-Mini-Program\html-code\App.tsx:396-399 ，已按角色切换拨号目标
  - 小程序： wx.makePhoneCall({ phoneNumber }) ，不能用 tel: ；应在小程序页面逻辑层调用
- 存储与登录
  - 网页： localStorage 存储当前用户与订单；登录模拟在 services/mockDatabase.ts:25-46
  - 小程序： wx.setStorage / wx.getStorage ；授权手机号用 wx.getPhoneNumber ，后端解密并写入数据库，再更新小程序内的用户资料
- 网络访问
  - 网页： fetch 并附加鉴权头，你的远端模式在 services/mockDatabase.ts:57-64, 73-92, 124-132, 163-171
  - 小程序： wx.request ；必须将数据网关域名加入“request 合法域名白名单”，否则请求失败
为什么“网页工程不会在小程序里形成页面”

- 小程序不能直接加载 index.html ，也没有 DOM 挂载点（没有 document.getElementById('root') 可用）。你的项目依赖 index.html 与 DOM 挂载，这与小程序的渲染机制不兼容。
- 小程序要求 WXML 模板与页面配置；React 组件与 JSX 必须编译为小程序对应的模板与脚本，或者由你手动重建为 WXML/WXSS/JS。
如何让你的功能在小程序“形成页面”

- 原生小程序路径（完全按小程序规范落地）
  - 新建工程结构，拆分页面：
    - 登录页：手机号授权与设置逻辑使用 wx.getPhoneNumber ，后端校验并保存手机号
    - 首页：订单列表（客户/师傅视角），使用 wx.request 调用数据网关
    - 发布需求页：表单与图片上传；服务方式枚举转换为小程序选择组件
    - 订单详情页：拨号改为 wx.makePhoneCall ；按角色切换拨号目标（你网页已有逻辑）
    - 个人中心：展示头像/姓名/手机号，支持修改（调用 PATCH /users/{id}/phone ）
  - 组件迁移：
    - OrderCard.tsx → 小程序组件（列表项）
    - StatusBadge.tsx → 小程序组件（状态徽章）
    - 底部 Tab → 原生 tabBar 或自定义组件
  - 网络与域名配置：
    - 在小程序管理后台添加你的“数据网关”域名为合法域名
    - 接口返回结构对齐 Order 类型（ d:\develop\ISO\Campus-Repair-Mini-Program\html-code\types.ts:31-50 ），包括中文枚举状态与毫秒时间戳
- 跨端框架路径（尽量保留 React 代码）
  - 使用 Taro/Remax/Uni-app，将 React/Vue 代码编译为小程序端产物
  - 将 App.tsx 中的“视图枚举”改为“多页面路由”，把表单与组件按框架适配
  - 将 fetch/localStorage/tel: 等替换为跨端 API（Taro 的 Taro.request/Taro.makePhoneCall/Taro.setStorage ）
你当前工程与小程序的结合点

- 数据网关与契约
  - 已支持远端模式：提供 VITE_API_BASE_URL 与可选 VITE_API_TOKEN 即可请求接口
  - 小程序端同样需要这些接口，但调用方式改为 wx.request ；域名需要在微信后台配置
- 业务契约（订单结构）
  - 保持返回与 Order 类型一致：中文状态枚举、毫秒时间戳、 images 数组、 techPhone/customerPhone 、 techId/techName
  - 这可确保你网页端与小程序端都能复用同一后端网关
迁移建议与路线图

- 明确目标平台：如果你“只做小程序”，建议走原生小程序或 Taro；如果你要“网页+小程序双端”，建议走 Taro 以减少维护成本。
- 先迁移关键功能：
  - 登录授权手机号（小程序特有）：实现 wx.getPhoneNumber 授权后端解密与保存（你网页已有“设置手机号”弹窗作为占位）
  - 拨号：用 wx.makePhoneCall ，沿用你当前角色切换逻辑
  - 订单 CRUD 与状态更新：将 fetch 改为 wx.request ，契约不变
- 配置与上线：
  - 微信开发者工具导入与运行
  - 小程序后台配置合法域名与权限说明
  - 提交审核与发布
结尾说明

- 你看到的这句话“你当前项目的结构和技术栈是典型的网页应用，微信小程序不是浏览器环境，它需要完全不同的工程结构”本质是在强调“运行时与工程规范完全不同”，所以网页工程不会自动在小程序里变成页面。
- 但你的业务模型与接口契约可以保持一致，迁移时重点在“适配渲染层与系统 API”，而不是重写所有逻辑。选择合适的路径（原生或跨端框架），我们就能把你现有的业务快速落地到小程序端。